<%= blazer_title "New Query" %>
<%# <%= render partial: "form" %>

<div class="padding left-align">
  <h5 class="">New Query</h5>
</div>

<div class="sage-container">
  <div class="sage-header">
    <h5>What are you curious about?</h5>
  </div>

  <%= form_with url: queries_path, method: :post, local: false, scope: :query, data: { turbo_frame: "query_result" } do |f| %>
    <div class="form-group">
      <%= label_tag "query[question]", "Your Question", class: "form-label" %>
      <%= text_area_tag "query[question]", nil, 
          class: "form-control", 
          rows: 3,
          placeholder: "e.g., Show me the top 10 customers by revenue in the last 30 days",
          required: true,
          data: { sage_target: "question" } %>
      <small class="form-text text-muted">
        Be specific about tables, columns, and conditions when possible
      </small>
    </div>

    <div class="form-actions">
      <button type='submit' data-disable-with='Generating...'>Generate Report</button>
    </div>
  <% end %>

  <turbo-frame id="query_result">
  </turbo-frame>

  <% if @schema.present? %>
    <div class="padding">
      <h6>Schema Guide</h6>
      <p class="small-text">Available tables and their columns</p>
      
      <div class="grid">
        <% @schema.each_with_index do |table_info, index| %>
          <div class="s12 m6 l4">
            <article class="schema-card">
              <h5 class="table-title">
                <i class="small">table</i>
                <%= table_info[:table].to_s.gsub('_', ' ').titleize.truncate(20) %>
              </h5>
              <p class="small-text grey-text table-name"><%= table_info[:table].truncate(25) %></p>
              
              <p class="column-count">
                <span class="large-text"><%= table_info[:columns].size %></span>
                <span class="small-text">columns</span>
              </p>
              
              <%= link_to "View Columns", 
                  table_schema_queries_path(table_name: table_info[:table]), 
                  class: "button small view-columns-btn",
                  data: { turbo_frame: "overlay" } %>
            </article>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="center-align padding">
      <p class="grey-text">Schema information not available</p>
    </div>
  <% end %>
</div>

<style>
  .sage-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }

  .sage-header {
    margin-bottom: 30px;
    text-align: center;
  }

  .sage-header h1 {
    margin-bottom: 10px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-label {
    font-weight: bold;
    margin-bottom: 5px;
    display: block;
  }

  .form-control {
    width: 100%;
    padding: 8px 12px;
    font-size: 14px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }

  .form-control:focus {
    outline: none;
    border-color: #4CAF50;
    box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
  }

  .form-actions {
    text-align: center;
  }

  .btn {
    display: inline-block;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: 500;
    text-align: center;
    text-decoration: none;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary {
    background-color: #4CAF50;
    color: white;
  }

  .btn-primary:hover {
    background-color: #45a049;
  }

  .btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .text-muted {
    color: #666;
    font-size: 14px;
  }

  .schema-card {
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .table-title {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 5px;
  }

  .table-name {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 10px;
  }

</style>

